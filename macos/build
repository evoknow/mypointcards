#!/bin/bash

set -e

APP_NAME="MyPointCards"
APP_FILE="${APP_NAME}.app"
HTML_FILE="../mypointcards-v1.html"
ICON_FILE="AppIcon.icns"
DMG_FILE="${APP_NAME}-1.0.dmg"

echo "ğŸ”§ Setting up Python virtual environment..."
python3 -m venv venv > /dev/null 2>&1
source venv/bin/activate

echo "ğŸš€ Building macOS app bundle..."
./macos_app.py --html "$HTML_FILE" --name "$APP_NAME" --icon "$ICON_FILE" > /dev/null

echo "ğŸ“¦ Creating DMG installer..."
./make_dmg.py --app "$APP_FILE" > /dev/null

if [ -f "$DMG_FILE" ]; then
    echo "âœ… DMG created: $DMG_FILE"
else
    echo "âŒ DMG creation failed"
    exit 1
fi

echo "ğŸ“ Final app bundle:"
ls -l "$APP_FILE/Contents" | grep -vE '^total' || true

